== Расчеты показателей решения

=== 2.07.1 Расчеты показателей производительности

**Базовые метрики системы (половинная нагрузка):**

- 5M активных пользователей (MAU)
- 25M активных объявлений
- Пиковая нагрузка: **25,150 RPS**
- Суточная нагрузка: **330.75M запросов**

**Распределение нагрузки по сервисам:**
[cols="2,2,2,2,2", options="header"]
|===
| Сервис | Пиковый RPS | Запросов/день | Данные/запрос | Пиковый трафик
| Advertisement (поиск/просмотр) | 20,000 | 250M | 30KB | 600 MB/s
| Advertisement (создание/редактир.) | 2,500 | 5M | 100KB | 250 MB/s
| User Service | 1,500 | 25M | 5KB | 7.5 MB/s
| Chat Service | 750 | 50M | 2KB | 1.5 MB/s
| Order Service | 250 | 0.5M | 10KB | 2.5 MB/s
| Payment Service | 150 | 0.25M | 5KB | 0.75 MB/s
| **Итого** | **25,150** | **330.75M** | - | **~861 MB/s**
|===

**Объемы данных:**

- Хранилище объявлений: 5 TB
- Медиаконтент: 125 TB
- Данные пользователей: 250 GB
- История чатов: 5 TB
- Поисковый индекс: 1.25 TB
- **Итого: ~137 TB**

=== 2.07.2 Критические компоненты высокой производительности
[cols="2,2,2", options="header"]
|===
| Компонент | Нагрузка | Критичность
| Elasticsearch кластер | 20,000 RPS поиска | КРИТИЧЕСКАЯ
| API Gateway | 25,150 RPS маршрутизации | КРИТИЧЕСКАЯ
| Медиа-хранилище S3 | 250 MB/s upload | ВЫСОКАЯ
| PostgreSQL (Advertisement) | 5,000 транз/сек | ВЫСОКАЯ
| Redis кэш | 50,000 операций/сек | СРЕДНЯЯ
| Kafka | 50,000 сообщений/сек | СРЕДНЯЯ
|===

=== 2.07.3 Оценка готовности архитектуры
**Текущая конфигурация для 25,150 RPS:**

*Elasticsearch (поиск):* 10 нод, 32 GB RAM, 2 TB SSD. Способен обрабатывать 20,000 RPS с latency ≤ 300 мс. Запас производительности: 25% (до 25,000 RPS).

*API Gateway:* 3 инстанса за Load Balancer, CloudFront CDN. Способен обрабатывать 25,150 RPS. Запас: 20% (до 30,180 RPS).

*PostgreSQL:* 2 шарда, master + 2 replica каждый. Способен обрабатывать 5,000 транз/сек. Запас: 25% (до 6,250 транз/сек).

**Вывод:** Архитектура готова к указанной нагрузке с запасом 20-25%.

== Масштабирование
=== 2.07.4 Масштабирование в рамках текущей архитектуры
**Горизонтальное масштабирование:**

- Увеличение количества инстансов сервисов за балансировщиком
- Добавление read-replicas для баз данных
- Увеличение количества партиций в Kafka

**Scale-up триггеры:**
[cols="1,2,2", options="header"]
|===
| Компонент | Триггер масштабирования | Действие
| Elasticsearch | Latency > 400 мс (p95) | +2 ноды к кластеру
| API Gateway | RPS > 22,635 | +1 инстанс за LB
| PostgreSQL | Connections > 1,800 | Добавить read replica
| Redis | Memory > 75% | +1 нода к cluster
|===