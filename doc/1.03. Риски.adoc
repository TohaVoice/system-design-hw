= Анализ рисков
:icons: font
:toc:

== Введение

Данный документ описывает потенциальные риски, связанные с реализацией функциональных и нефункциональных требований сервиса объявлений с доставкой и оплатой.
Риски оцениваются по шкале: Высокая (В), Средняя (С), Низкая (Н).

== Риски функциональных требований

[cols="1,2,1,1,2", options="header"]
|===
| ID | Риск | В | Вл | Меры по снижению

| FR-01
| *Advertisement Service*: Падение производительности поиска при росте количества объявлений
| С
| В
| Внедрение ElasticSearch, кэширование результатов, оптимизация индексов

| FR-02
| *Admin Service*: Обработка медиа становится узким местом, задержки при модерации
| С
| С
| Асинхронная обработка, очереди сообщений, горизонтальное масштабирование

| FR-03
| *User & Auth Service*: Утечка PII данных пользователей
| Н
| В
| Шифрование данных, строгий контроль доступа, аудит

| FR-04
| *Order Service*: Потеря согласованности в Saga Pattern (деньги списаны, но заказ не выполнен)
| С
| В
| Надежный механизм компенсационных транзакций, мониторинг состояния Saga, ретраи

| FR-05
| *Payment Service*: Сбой интеграции с платежными системами
| С
| В
| Circuit breaker, fallback-провайдеры, верификация состояния через вебхуки

| FR-06
| *Delivery Service*: Неточный расчет стоимости или сроков доставки
| С
| С
| Кэширование тарифов, периодическая синхронизация с API СДЭК/Почты России, понятные условия для пользователя

| FR-07
| *Notification Service*: Потеря уведомлений (email/SMS не доставляются)
| С
| С
| Persistent queues, подтверждение доставки от SMTP/SMS-провайдеров, retry policy

| FR-08
| *Chat Service*: Проблемы с масштабированием WebSocket соединений
| С
| С
| Использование специализированных решений (Socket.io с адаптерами), разделение по комнатам/шардам
|===

== Риски нефункциональных требований

[cols="1,2,1,1,2", options="header"]
|===
| ID | Риск | В | Вл | Меры по снижению

| NFR-01
| *Производительность*: Невыполнение целевых показателей latency (p99 > 500 мс)
| С
| В
| Регулярные нагрузочные тесты, профилирование кода, оптимизация запросов к БД

| NFR-02
| *Надежность*: Недостижение SLA 99.9% доступности
| Н
| В
| Избыточная архитектура (multi-AZ), health checks, автоматическое восстановление

| NFR-03
| *Масштабируемость*: Автоскейлинг не успевает за резким ростом нагрузки (flash crowd)
| С
| С
| Predictive scaling на основе расписания, buffer capacity, graceful degradation

| NFR-04
| *Безопасность*: DDoS-атака нарушает работу сервиса
| С
| В
| Использование Cloudflare/AWS Shield, rate limiting на уровне API Gateway, blacklisting

| NFR-05
| *Данные*: Потеря данных из-за сбоя в репликации или backup
| Н
| В
| Регулярное тестирование восстановления из backup, мониторинг рассинхронизации реплик

| NFR-06
| *Зависимости*: Сбой внешних сервисов (СДЭК, платежные системы) влияет на нашу доступность
| С
| С
| Circuit breaker, асинхронная обработка, четкое разделение responsibility (наша недоступность ≠ их недоступность)
|===

*Примечание: Риски с высокой вероятностью и высоким влиянием требуют первоочередного внимания.*

== План управления рисками

1. *Приоритизация*: Фокус на рисках FR-04 (Saga), FR-05 (Payment), NFR-04 (DDoS)
2. *Мониторинг*: Внедрение метрик для раннего обнаружения рисков (латентность, error rate, availability)
3. *Регулярный пересмотр*: Обновление матрицы рисков ежеквартально
4. *Коммуникация*: Информирование стейкхолдеров о ключевых рисках и принимаемых мерах